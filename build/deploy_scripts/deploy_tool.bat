@echo off

call ../init_vis_studio_env.bat

set BIN_FOLDER=../../bin/
set GAME_BIN_FOLDER=%BIN_FOLDER%game/
set TOOLS_BIN_FOLDER=%BIN_FOLDER%tools/
set TOOLDEPLOY_BIN_FOLDER=%TOOLS_BIN_FOLDER%%2/
REM %TOOLDEPLOY_BIN_FOLDER%debug
set TOOLDEPLOY_BIN_FOLDER_D=%TOOLS_BIN_FOLDER%
REM %TOOLDEPLOY_BIN_FOLDER%release
set TOOLDEPLOY_BIN_FOLDER_R=%TOOLS_BIN_FOLDER%
set TOOL_BIN_FOLDER_R=../../build/built_projects/%PREMAKEVSVER%/tools/lib/Release
set TOOL_BIN_FOLDER_D=../../build/built_projects/%PREMAKEVSVER%/tools/lib/Debug
set ROBOCOPY_OPTIONS=/XO /XX /njh /njs /ndl /nc /ns /np
REM set ROBOCOPY_OPTIONS=/XO /XX

echo %TOOLDEPLOY_BIN_FOLDER_D%

IF NOT exist "%BIN_FOLDER%" mkdir "%BIN_FOLDER%"
IF NOT exist "%GAME_BIN_FOLDER%" mkdir "%GAME_BIN_FOLDER%"
IF NOT exist "%TOOLS_BIN_FOLDER%" mkdir "%TOOLS_BIN_FOLDER%"
IF NOT exist "%TOOLDEPLOY_BIN_FOLDER%" mkdir "%TOOLDEPLOY_BIN_FOLDER%"
IF NOT exist "%TOOLDEPLOY_BIN_FOLDER_D%" mkdir "%TOOLDEPLOY_BIN_FOLDER_D%"
IF NOT exist "%TOOLDEPLOY_BIN_FOLDER_R%" mkdir "%TOOLDEPLOY_BIN_FOLDER_R%"

IF exist "%TOOL_BIN_FOLDER_D%" ROBOCOPY "%TOOL_BIN_FOLDER_D%" "%TOOLDEPLOY_BIN_FOLDER_D%" "%1*.dll" "%1*.exe" "%1*.pdb" %ROBOCOPY_OPTIONS%
IF exist "%TOOL_BIN_FOLDER_R%" ROBOCOPY "%TOOL_BIN_FOLDER_R%" "%TOOLDEPLOY_BIN_FOLDER_R%" "%1*.dll" "%1*.exe" "%1*.pdb" %ROBOCOPY_OPTIONS%

IF %ERRORLEVEL% GTR 2 GOTO :REPORT_ERRORLEVEL

:EXIT
EXIT /B 0

:REPORT_ERRORLEVEL
echo.
if ERRORLEVEL 16 echo ***FATAL ERROR*** & goto :FATAL_ERROR
if ERRORLEVEL 8 echo **FAILED COPIES** & goto :FATAL_ERROR
if ERRORLEVEL 4 echo *MISMATCHES* & goto :FATAL_ERROR
if ERRORLEVEL 2 echo EXTRA FILES & goto :EXIT

:FATAL_ERROR
echo ERROR EXIT
REM EXIT